% load data
clc
clear

if isunix
    sep='/';
else
    sep = '\';
end

% imDir = '/srv/glusterfs/tannerch/forLin/dataset';
% 
% dat = num2str(57);
% b = num2str(1);
% 
% load([imDir dat '/ref' b '.mat']);
% data = refs(:,:,2:end);
% 
% load('/scratch_net/lokum/linzhan/flownet_registration_cycle_ssim/data57/B1_flownet_registration_cycle_ssim_exp2_e180_images.mat')
% load('/scratch_net/lokum/linzhan/flownet_registration_cycle_ssim/data57/B1_flownet_registration_cycle_ssim_exp2_e180_p1.mat')
% load('/scratch_net/lokum/linzhan/flownet_registration_cycle_ssim/data57/B1_flownet_registration_cycle_ssim_exp2_e180_p2.mat')

%%
p1_cycle_ssim = p1;
p2_cycle_ssim = p2;
x3_hat_cycle_ssim = x3_hat;

dx=4;
[X,Y] = meshgrid(1:dx:224,1:dx:224);

for i = 58:77

u_im1_cycle_ssim = squeeze(p1_cycle_ssim(i,:,:,1));
v_im1_cycle_ssim = squeeze(p1_cycle_ssim(i,:,:,2));

u_im2_cycle_ssim = squeeze(p2_cycle_ssim(i,:,:,1));
v_im2_cycle_ssim = squeeze(p2_cycle_ssim(i,:,:,2));

subU2_cycle_ssim = u_im2_cycle_ssim(1:dx:end,1:dx:end);
subV2_cycle_ssim = v_im2_cycle_ssim(1:dx:end,1:dx:end);

subU1_cycle_ssim = u_im1_cycle_ssim(1:dx:end,1:dx:end);
subV1_cycle_ssim = v_im1_cycle_ssim(1:dx:end,1:dx:end);

figure(1)

subplot(2,3,1)
imagesc(data(:,:,(i+1)*2)',[0,255]);
colormap gray;
axis tight
axis equal
axis off
title('Ground Truth')

subplot(2,3,2)
imagesc(squeeze(x3_hat_cycle_ssim(i,:,:)),[0,255]);
axis tight
axis equal
axis off
title('Interpolated Images')

subplot(2,3,3)
imagesc(squeeze(x3_hat_cycle_ssim(i,:,:))-data(:,:,(i+1)*2)',[-50,50]);
axis tight
axis equal
axis off
title('Difference Images')

subplot(2,3,4)
imagesc(data(:,:,(i+1)*2-1)'-data(:,:,(i+1)*2)', [-50, 50]);
hold on
quiver(X,Y,subU1_cycle_ssim,subV1_cycle_ssim,0, 'r')
hold off
title('Displacement field (t->t-1)')
axis equal
axis tight
axis off

subplot(2,3,5)
imagesc(data(:,:,(i+1)*2+1)'-data(:,:,(i+1)*2)', [-50, 50]);
hold on
quiver(X,Y,subU2_cycle_ssim,subV2_cycle_ssim,0, 'r')
hold off
title('Displacement field (t+1->t)')
axis equal
axis tight
axis off


end